
<!-- README.md is generated from README.Rmd. Please edit that file -->

# hypeR.GEM

## Installation

Install the development version of the package from Github. <span
style="color:#0278ae">**\[Recommended\]**</span>

``` r
devtools::install_github("montilab/hypeR-GEM")
```

## Usage

``` r
library(hypeR.GEM)
#library(tidyverse)
library(hypeR)
```

``` r
data(EL_signature)

str(EL_signature)
```

    #> List of 2
    #>  $ EL_up  :'data.frame': 311 obs. of  5 variables:
    #>   ..$ CHEMICAL_NAME: chr [1:311] "c-glycosyltryptophan" "vanillactate" "hydroxyasparagine**" "cysteine s-sulfate" ...
    #>   ..$ refmet_name  : chr [1:311] "alpha-C-Mannosyltryptophan" "Vanillactic acid" "Hydroxyasparagine" "Cysteine-S-sulfate" ...
    #>   ..$ cent.Estimate: num [1:311] 0.824 1.049 0.858 0.882 1.44 ...
    #>   ..$ cent.p.value : num [1:311] 5.25e-14 3.92e-13 2.69e-12 3.77e-12 6.46e-12 ...
    #>   ..$ cent.q.value : num [1:311] 5.52e-11 2.06e-10 9.42e-10 9.92e-10 1.36e-09 ...
    #>  $ EL_down:'data.frame': 96 obs. of  5 variables:
    #>   ..$ CHEMICAL_NAME: chr [1:96] "epiandrosterone sulfate" "dehydroepiandrosterone sulfate (dhea-s)" "androstenediol (3beta,17beta) monosulfate (1)" "x-11378" ...
    #>   ..$ refmet_name  : chr [1:96] "Epiandrosterone" "Dehydroepiandrosterone sulfate" "4-Androsten-3beta,17beta-diol 17-sulfate" NA ...
    #>   ..$ cent.Estimate: num [1:96] -1.9 -1.44 -1.64 -1.12 -1.75 ...
    #>   ..$ cent.p.value : num [1:96] 7.73e-08 1.35e-07 1.95e-07 6.28e-07 1.07e-06 ...
    #>   ..$ cent.q.value : num [1:96] 1.77e-06 2.91e-06 3.51e-06 9.31e-06 1.40e-05 ...

``` r
hypeR_GEM_obj <- hypeR.GEM::signature2gene(signatures = EL_signature,
                                           species = "Human",
                                          ensemble_id = TRUE,
                                          reference_key = 'refmet_name')
str(hypeR_GEM_obj)
```

    #> List of 2
    #>  $ mapped_metabolite_signatures:List of 2
    #>   ..$ EL_up  :'data.frame':  254 obs. of  9 variables:
    #>   .. ..$ name            : chr [1:254] "MAM00199c" "MAM00205c" "MAM00205g" "MAM00205l" ...
    #>   .. ..$ fullname        : chr [1:254] "[protein]-L-citrulline" "[protein]-L-serine" "[protein]-L-serine" "[protein]-L-serine" ...
    #>   .. ..$ refmet_name     : chr [1:254] "Citrulline" "Serine" "Serine" "Serine" ...
    #>   .. ..$ gene_association: num [1:254] 5 2 21 3 2 30 26 5 2 3 ...
    #>   .. ..$ compartment     : chr [1:254] "c" "c" "g" "l" ...
    #>   .. ..$ formula         : chr [1:254] "C6H13N3O3" "C3H7NO3" "C3H7NO3" "C3H7NO3" ...
    #>   .. ..$ super_class     : chr [1:254] "Organic acids" "Organic acids" "Organic acids" "Organic acids" ...
    #>   .. ..$ main_class      : chr [1:254] "Amino acids and peptides" "Amino acids and peptides" "Amino acids and peptides" "Amino acids and peptides" ...
    #>   .. ..$ sub_class       : chr [1:254] "Amino acids" "Amino acids" "Amino acids" "Amino acids" ...
    #>   ..$ EL_down:'data.frame':  74 obs. of  9 variables:
    #>   .. ..$ name            : chr [1:74] "MAM00003c" "MAM00003l" "MAM00003r" "MAM00003e" ...
    #>   .. ..$ fullname        : chr [1:74] "(10Z)-heptadecenoic acid" "(10Z)-heptadecenoic acid" "(10Z)-heptadecenoic acid" "(10Z)-heptadecenoic acid" ...
    #>   .. ..$ refmet_name     : chr [1:74] "10Z-Heptadecenoic acid" "10Z-Heptadecenoic acid" "10Z-Heptadecenoic acid" "10Z-Heptadecenoic acid" ...
    #>   .. ..$ gene_association: num [1:74] 30 2 11 15 25 4 2 14 1 1 ...
    #>   .. ..$ compartment     : chr [1:74] "c" "l" "r" "e" ...
    #>   .. ..$ formula         : chr [1:74] "C17H32O2" "C17H32O2" "C17H32O2" "C17H32O2" ...
    #>   .. ..$ super_class     : chr [1:74] "Fatty Acyls" "Fatty Acyls" "Fatty Acyls" "Fatty Acyls" ...
    #>   .. ..$ main_class      : chr [1:74] "Fatty acids" "Fatty acids" "Fatty acids" "Fatty acids" ...
    #>   .. ..$ sub_class       : chr [1:74] "Unsaturated FA" "Unsaturated FA" "Unsaturated FA" "Unsaturated FA" ...
    #>  $ gene_tables                 :List of 2
    #>   ..$ EL_up  :'data.frame':  450 obs. of  12 variables:
    #>   .. ..$ name                  : chr [1:450] "ENSG00000000419" "ENSG00000002726" "ENSG00000003989" "ENSG00000004864" ...
    #>   .. ..$ symbol                : chr [1:450] "DPM1" "AOC1" "SLC7A2" "SLC25A13" ...
    #>   .. ..$ associated_reactions  : num [1:450] 2 32 25 3 2 8 7 29 3 4 ...
    #>   .. ..$ total_association     : num [1:450] 677 57 46 8 8 20 14 50 9 6 ...
    #>   .. ..$ signature_association : num [1:450] 16 1 8 2 2 4 2 6 1 2 ...
    #>   .. ..$ signature_size        : int [1:450] 254 254 254 254 254 254 254 254 254 254 ...
    #>   .. ..$ background            : int [1:450] 6700 6700 6700 6700 6700 6700 6700 6700 6700 6700 ...
    #>   .. ..$ p_value               : num [1:450] 9.79e-01 6.43e-01 4.52e-05 2.62e-03 2.62e-03 ...
    #>   .. ..$ fdr                   : num [1:450] 0.990058 0.669367 0.000496 0.009814 0.009814 ...
    #>   .. ..$ one_minus_p_value     : num [1:450] 0.0209 0.3574 1 0.9974 0.9974 ...
    #>   .. ..$ one_minus_fdr         : num [1:450] 0.00994 0.33063 0.9995 0.99019 0.99019 ...
    #>   .. ..$ associated_metabolites: chr [1:450] "Citrulline;Sorbitol;N-Formylmethionine;Glycolithocholic acid;N-Acetylalanine;Taurodeoxycholic acid;Trimethylami"| __truncated__ "N-Acetylputrescine" "Citrulline;Phenylalanine;Proline;Serine" "Aspartic acid" ...
    #>   ..$ EL_down:'data.frame':  223 obs. of  12 variables:
    #>   .. ..$ name                  : chr [1:223] "ENSG00000000419" "ENSG00000003137" "ENSG00000005483" "ENSG00000006757" ...
    #>   .. ..$ symbol                : chr [1:223] "DPM1" "CYP26B1" "KMT2E" "PNPLA4" ...
    #>   .. ..$ associated_reactions  : num [1:223] 2 11 7 9 2 28 86 11 3 7 ...
    #>   .. ..$ total_association     : num [1:223] 677 29 14 22 6 64 136 26 11 14 ...
    #>   .. ..$ signature_association : num [1:223] 7 2 1 1 1 3 4 2 3 1 ...
    #>   .. ..$ signature_size        : int [1:223] 74 74 74 74 74 74 74 74 74 74 ...
    #>   .. ..$ background            : int [1:223] 6700 6700 6700 6700 6700 6700 6700 6700 6700 6700 ...
    #>   .. ..$ p_value               : num [1:223] 0.47606 0.00385 0.01005 0.0241 0.00175 ...
    #>   .. ..$ fdr                   : num [1:223] 0.48255 0.01046 0.01648 0.03125 0.00584 ...
    #>   .. ..$ one_minus_p_value     : num [1:223] 0.524 0.996 0.99 0.976 0.998 ...
    #>   .. ..$ one_minus_fdr         : num [1:223] 0.517 0.99 0.984 0.969 0.994 ...
    #>   .. ..$ associated_metabolites: chr [1:223] "Pregnenolone sulfate;Linoleic acid;MG 20:4;5alpha-Androstane-3alpha-ol-17-one sulfate" "Retinol" "N(6)-Methyllysine" "Retinol" ...

``` r
kegg <- hypeR::msigdb_gsets(species="Homo sapiens", category="C2", subcategory = "CP:KEGG", clean = TRUE)
print(kegg)
```

    #> C2.CP:KEGG v7.5.1 
    #> Abc Transporters (44)
    #> Acute Myeloid Leukemia (57)
    #> Adherens Junction (73)
    #> Adipocytokine Signaling Pathway (67)
    #> Alanine Aspartate And Glutamate Metabolism (32)
    #> Aldosterone Regulated Sodium Reabsorption (42)

## Hypergeometric test

### KEGG (unweighted)

``` r
max_fdr <- 0.01
kegg_unweighted <- hypeR.GEM::enrichment(hypeR_GEM_obj,
                                         genesets = kegg$genesets,
                                         method='unweighted',
                                         weights = 'one_minus_p_value',
                                         background=3068)

hypeR.GEM::enrichment_plot(kegg_unweighted,
                           top=40,
                           abrv=50,
                           size_by="significance",
                           fdr_cutoff= max_fdr,
                           val='fdr')+
  ggplot2::ggtitle(paste("FDR ≤", max_fdr)) +
  ggplot2::theme(axis.text.y = element_text(size = 7))
```

![](README_files/figure-gfm/unnamed-chunk-6-1.png)<!-- -->

### KEGG (weighted)

``` r
max_fdr <- 0.01
kegg_weighted <- hypeR.GEM::enrichment(hypeR_GEM_obj,
                                         genesets = kegg$genesets,
                                         method='weighted',
                                         weights = 'one_minus_p_value',
                                         background=3068)

hypeR.GEM::enrichment_plot(kegg_weighted,
                           top=40,
                           abrv=50,
                           size_by="significance",
                           fdr_cutoff= max_fdr,
                           val='fdr')+
  ggplot2::ggtitle(paste("FDR ≤", max_fdr)) +
  ggplot2::theme(axis.text.y = element_text(size = 7))
```

![](README_files/figure-gfm/unnamed-chunk-7-1.png)<!-- -->
