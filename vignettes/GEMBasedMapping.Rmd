---
title: "Reaction-based mapping using Genome-scale Metabolic Models(GEMs)"
output: rmarkdown::html_vignette
author: "Ziwei Huang"
date: "03/10/2024"
vignette: >
  %\VignetteIndexEntry{Reaction-based mapping using Genome-scale Metabolic Models(GEMs)}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<font color = "#000000">

```{r}
devtools::load_all(".")
```

## What are genome-scale metabolic models(GEMs)?

Genome-scale metabolic models(GEMs) are curated metabolic models collect all known metabolic information of a biological system(e.g. human cell). There are three essential components in a GEM:

  -**metabolites**: all known metabolites of a biological system.
  -**reactions**: all known reactions of a biological system.
  -**protein(-coding) genes**

including the , **protein(-coding) genes**, **reactions**, and **metabolites**.

See [here](https://www.pnas.org/doi/abs/10.1073/pnas.2102344118) for more details.  


Here is a schematic diagram of a GEM:

The capital letters represent metabolites, and $r_i$ represents $i^{th}$ reaction. A prototypical reactions includes three parts:

  - **reactants(substrates)**: one or more metabolites that are consumed (left-hand side)
  - **products**:  one or more metabolites that are produced (right-hand side)
  - **catalyst**： protein(-coding) genes that catalyze the reaction
  

```{r echo=FALSE, out.height="80%", out.width="80%"}
knitr::include_graphics("figs/intro_GEM.png")
```

## Mapping workflow

To map a metabolite to its associated protein(-coding) genes, we define three types of associations:

  - **metabolite-reaction association**: A metabolite is associated with a reaction if:
    - The metabolite is either the reactant or the product of the reaction (**undirectional**)
    - The metabolite is is the product of the reaction (**directional**)
  
  - **reaction-protein(-coding) gene association**: A reaction is associated with protein(-coding) genes if these genes catalyze the reaction.
  
  - **metabolite-protein(-coding) gene association**: A metaboblite is associated with all protein(-coding) genes that catalyze the reactions associated with the metabolite.
  
```{r echo=FALSE, out.height="80%", out.width="80%"}
knitr::include_graphics("figs/mapping.png")
```

## Accounting for Gene “Promiscuity”

Some genes in a GEM can be highly "promiscuous" (catalyzed too many reactions, and thus, associated with too many metabolites).  To take this into account, we compute gene-spefic p-values that indicate the mapping specificity.

```{r echo=FALSE, out.height="80%", out.width="80%"}
knitr::include_graphics("figs/gene_promiscuity.png")
```


## Example

Here, we are using a dataset of coronavirus disease 2019 (COVID-19) metabolite signatures obtained from human urine samples (See [reference](https://www.sciencedirect.com/science/article/pii/S2211124721017836#da0010))

### Load metabolite signature
```{r}
data(COVID_urine)
```

### hypeR-GEM mapping
```{r}
## Undirectional mapping
hypeR_GEM_obj <- hypeR.GEM::signature2gene(signatures = COVID_urine,
                                           directional = FALSE,
                                           species = "Human",
                                           merge = TRUE,
                                           promiscuous_threshold = 500,
                                           ensemble_id = TRUE,
                                           reference_key = 'refmet_name',
                                           background = NULL)

##Directional mapping
hypeR_GEM_obj_di <- hypeR.GEM::signature2gene(signatures = COVID_urine,
                                            directional = TRUE,
                                            species = "Human",
                                            merge = TRUE,
                                            promiscuous_threshold = 500,
                                            ensemble_id = TRUE,
                                            reference_key = 'refmet_name',
                                            background = NULL)
```


</font>
--
